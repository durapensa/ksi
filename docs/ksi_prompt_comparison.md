# KSI Prompt Generation: Raw JSON vs Claude-Friendly Format

## Overview

The KSI discovery system provides comprehensive event information in JSON format, but this raw data needs transformation to be effective as a Claude prompt. Here's how the generated `ksi_prompt.txt` differs from the raw discovery output.

## Key Transformations

### 1. Structure: From Data to Instructions

**Raw JSON Discovery:**
```json
{
  "namespaces": ["completion", "conversation", "state", ...],
  "events": {
    "completion": [
      {
        "event": "completion:cancel",
        "summary": "Cancel an active completion request.",
        "parameters": {
          "request_id": {
            "description": "The request ID to cancel",
            "required": true
          }
        }
      }
    ]
  }
}
```

**Generated Prompt:**
```markdown
### 1. Completions - Run AI models with session continuity

**Cancel a running completion:**
```json
{"event": "completion:cancel", "data": {"request_id": "request-id-to-cancel"}}
```
```

### 2. Context Addition: What's Missing from Discovery

The raw discovery data lacks critical context that Claude needs:

#### Session Management Context
The discovery doesn't explain:
- That session IDs are returned by claude-cli and change with each request
- When to omit vs include session_id
- How conversation continuity actually works

The prompt adds:
```markdown
**Key points about sessions:**
- Omit `session_id` for new conversations (clean context)
- Each response returns a NEW session_id for the next request
- Use the returned session_id to continue conversations
- Session IDs are generated by claude-cli and cannot be changed
```

#### Undocumented Events
Some critical events like `completion:async` aren't in the discovery output but are essential. The prompt includes them based on implementation knowledge.

### 3. Logical Grouping: From Namespaces to Workflows

**Raw Structure:** Alphabetical namespace listing
```
- agent
- completion  
- conversation
- state
```

**Prompt Structure:** Grouped by use case
```
1. Completions - Run AI models
2. Conversations - Find and analyze past interactions
3. State Management - Persistent storage
4. Agent Management - Spawn and coordinate
5. Monitoring - Track activity
```

### 4. Concrete Examples: From Parameters to Usage

**Raw Discovery:**
```json
{
  "event": "state:set",
  "parameters": {
    "key": {"required": true, "type": "str"},
    "value": {"required": true, "type": "Any"}
  }
}
```

**Prompt Example:**
```json
{"event": "state:set", "data": {
  "key": "my_key",
  "value": {"any": "json", "data": "here"}
}}

// Shared state example:
{"event": "state:set", "data": {
  "key": "shared:project_context",
  "value": {"description": "Building a web app"}
}}
```

### 5. Workflow Patterns: Connecting Individual Events

The discovery shows isolated events. The prompt adds complete workflows:

```markdown
### Multi-turn Conversation
# First message - no session_id
{"event": "completion:async", "data": {"prompt": "Hello", "model": "claude-cli/sonnet"}}

# Continue conversation using previous session_id  
{"event": "completion:async", "data": {
  "prompt": "What did we just discuss?",
  "model": "claude-cli/sonnet",
  "session_id": "session-id-from-previous-response"
}}
```

### 6. Best Practices: Wisdom Beyond the API

The prompt includes learned patterns not in the discovery:
- Always use session IDs from previous responses
- Use shared state prefix for cross-agent data
- Check completion status before assuming success
- Terminate agents to free resources

## Additional Context for Effective KSI Usage

### Model Selection Guidance
```markdown
"model": "claude-cli/sonnet",    // or "claude-cli/opus"
```
Note: The discovery doesn't specify valid models, but the prompt clarifies only sonnet/opus work with claude-cli.

### Asynchronous Nature
```markdown
Remember: KSI is event-driven and asynchronous. Most operations return immediately 
with a request_id or status, and actual work happens in the background.
```

### Permission Context
The prompt explains what each permission profile means:
```markdown
- `restricted`: Basic read-only access
- `standard`: Read/write with limited tools
- `trusted`: Full tool access except system commands
- `researcher`: Specialized for research tasks
```

## Summary of Enhancements

1. **Narrative Structure**: Transforms flat API reference into guided documentation
2. **Missing Context**: Adds critical information about session management, models, and async behavior  
3. **Use Case Focus**: Groups by what users want to do, not technical namespaces
4. **Complete Examples**: Shows full request/response cycles and multi-step workflows
5. **Best Practices**: Includes wisdom from actual usage patterns
6. **Discovery Gaps**: Adds important events missing from auto-discovery (like completion:async)

The generated prompt serves as both a reference and a tutorial, making KSI immediately useful to Claude without requiring deep system knowledge.